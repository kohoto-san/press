{% extends "base.html" %}
{% load staticfiles %}


{% block head %}
    {{block.super}}
    <meta property="og:type" content="article" />
    <meta property="og:title" content="{{post.title}}" />
    <meta property="og:description" content="{{post.text_entry}}" />
    <meta property="og:url" content="http://startupden.ru{{ request.path }}" />
    <meta property="og:image" content="http://startupden.ru/media/{{post.image}}" />
    <meta property="og:site_name" content="startupden.ru" />
    
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:title" content="{{post.title}}" />
    <meta property="twitter:description" content="{{post.text_entry}}" />
    <meta property="twitter:image" content="http://startupden.ru/media/{{post.image}}" />
    
    {% comment %}        
    <!--
    <meta property="twitter:site" content="@vcru" />
    <meta property="twitter:creator" content="@vcru" />

    <meta property="fb:app_id" content="499950920109990" />
    -->
    {% endcomment %}

    <meta property="twitter:url" content="http://startupden.ru{{ request.path }}" />
    <meta property="author" content="Михаил Синов" />

    <link rel="stylesheet" type="text/css" href="{% static 'style.css' %}" />
    

{% endblock head %}




{% block navbar %}

    <div id="navbar" class="row valign-wrapper">
        
        <div class="col m2 s12 navbar-title">
            <h4 style="margin: 0;"><a href="/" style="color: #000;">StartupDen</a></h4>
        </div>

        <div class="col l8 hide-on-med-and-down" style="font-size: 18px;">
            {{post.title}}
        </div>
            
        <div class="share-btns col l2 m5 offset-m5 s12 right-align">
            <a class="vk popup" href="http://vk.com/share.php?url=" target="_blank"><img src="{% static 'vk_logo.png' %}"></a>
            <a class="twitter popup" href="http://twitter.com/share?text={{post.title}}" target="_blank"><img src="{% static 'twitter_logo.png' %}"></a>
            <a class="facebook popup" href="https://www.facebook.com/sharer/sharer.php?u=" target="_blank"><img src="{% static 'facebook_logo.png' %}"></a>
        </div>

    </div>

{% endblock navbar %}



{% block content %}
    

    <div class="post-cover">

        <div class="post-cover-image" style="background-image: url({{post.image.url}});"></div>


        <div class="overlay valign-wrapper" style="position: absolute; width: 100%; height: 100%; left: 0; top: 0; z-index: 10;">
            <div class="row valign" style="color: #fff;">

                <div class="col s12 l8 offset-l2 m10 offset-m1 center-align">
                    <h3 class="post-cover-title">{{post.title}}</h3>
                    <p style="color: #e6e6e6;">{{post.date|date:"DATE_FORMAT"}}</p>
                </div>
            
            </div>
        </div>


    </div>


    
    <div class="row" style="margin-top: 30px; margin-bottom: 100px;">                    <!-- 750 -->
        <div class="col l7 offset-l1 m10 offset-m1 s12" style="font-size: 1.15rem; max-width: 700px;">
            {{post.text_entry|safe}}
            {{post.text|safe}}
        </div> <!-- col s6 -->


        <div id="sidebar-share" class="col s3 offset-s1" style="margin-top: 40px; right: 0;">
            <div class="row">
                <div class="col s12" style="padding: 0; margin-bottom: 10px;">
                    <ul class="tabs">
                        <li class="tab col s3"><a href="#vk" class="active">Вконтакте</a></li>
                        <li class="tab col s3"><a href="#fb">Facebook</a></li>
                        <li class="tab col s3"><a href="#tw">Twitter</a></li>
                    </ul>
                </div>

            
                <div id="vk" class="col s12" style="height: 250px;"><div id="vk_groups"></div></div>
                <div id="fb" class="col s12">
                    
                    <div class="fb-page" data-width="270" data-height="250" data-href="https://www.facebook.com/startupden.ru/" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="false">
                        <div class="fb-xfbml-parse-ignore">
                            <blockquote cite="https://www.facebook.com/startupden.ru/">
                                <a href="https://www.facebook.com/startupden.ru/">StartupDen</a>
                            </blockquote>
                        </div>
                    </div>

                </div>
                <div id="tw" class="col s12">

                    <div class="card indigo lighten-3">
                        
                        <div class="card-content white-text">
                            <p style="margin-bottom: 20px;">Подпишись на наш Twitter, чтобы первым узнавать о самых последних новостях.</p>

                            <a class="twitter-follow-button" href="https://twitter.com/startupden_ru" data-size="large" data-show-count="false">
                                Follow @startupden_ru
                            </a>

                        </div>
                            
                    </div>
                    
                    

                </div>
            </div>

            <div class="row" style="margin-top: 20px;">
                    <div class="col s12">
                        <a href="mailto:touch@startupden.ru" class="write-us card hoverable blue-grey lighten-1">
                            <div class="card-content white-text">
                                <span class="card-title center-text">Напишите нам!</span>
                                <p>Хотите рассказать о вашем проекте или поделиться свои опытом? Напишите нам и мы с радостью опубликуем вашу колонку.</p>
                            </div>

                            <div class="write-us-action card-action center-align blue-grey darken-1">
                                <span style="color: #fff;">Написать</span>
                            </div>
                            
                        </a>
                    </div>
            </div> <!-- /.write-us -->
            
        </div> <!-- /.sidebar-share -->


        <div id="feature-wrapper" class="col l10 offset-l1 s12" style="font-size: 1.15rem; margin-top: 40px;">

            <h4 class="center-align" style=" width: 100%; border-bottom: 2px solid #9A9A9A; line-height: 0.1em; margin: 10px 0 50px;"><span style="background: #fff; padding: 0 10px;">Читайте также</span></h4>

            {% for post in recommended_posts %}
                <div class="col l3 m6 s12">
                    <a href="{% url 'post_detail' post.slug %}" class="card hoverable">
                        
                        <div class="card-image">
                            <img src="/media/{{post.image}}">
                        </div>

                        <div class="card-content">
                            <p>{{post.title}}</p>
                        </div>

                    </a>
                </div> <!-- /.col s3 -->
            {% endfor %}

        </div> <!-- /.col s10 -->

    </div> <!-- /.row -->



    <script src="{% static 'js.cookie.js' %}"></script>

    <script type="text/javascript">

        $(document).ready(function() {

            //var offset_horizontal = $('#sidebar-share').offset().left - ($('#sidebar-share').width() / 2);
            //$('#sidebar-share').css('left', offset_horizontal );

            //var offset_vertical = $('#feature-wrapper').offset().top - $('#sidebar-share').height();
            //$('#sidebar-share').pushpin({ top: $('#sidebar-share').offset().top, 'bottom': offset_vertical - 104 });


             var height = $(window).height() - 64;
        $('.post-cover').css('height', height);


        offset = $('.post-cover').position().top + $('.post-cover').height();

        $(document).keydown( function(event) {
            
            if(event.which === 13 && event.ctrlKey) {
                
                var txt = '';

                if (txt = window.getSelection){ // Не IE, используем метод getSelection
                    txt = window.getSelection().toString();
                } 
                else { // IE, используем объект selection
                  txt = document.selection.createRange().text;
                }

                if(txt != ''){
                    send_typo(txt);
                }
            }

        });

        function send_typo(text){

            id_post = {{post.id}};

            $.post( "/typo/", {pk: id_post, text: text}, function( data ) {
                
                if(data == 'sent'){
                    Materialize.toast('Спасибо за то, что сообщиил нам об ошибке! Мы в ближайшее время её исправим.', 4000);
                }

            });

        }

            
        });

        var csrftoken = Cookies.get('csrftoken');

        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }
        
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });





       
    </script>

    <script>
    $(document).ready(function() {

        $('.popup').click(function(event) {
            var width  = 575,
                height = 400,
                left   = ($(window).width()  - width)  / 2,
                top    = ($(window).height() - height) / 2,
                opts   = 'status=1' +
                         ',width='  + width  +
                         ',height=' + height +
                         ',top='    + top    +
                         ',left='   + left;

            if( $(this).hasClass('twitter') ){
                var url = this.href;
            }
            else{
                var url = this.href + window.location.href;
            }

            window.open(url, 'sharing', opts);
 
            return false;
        });
    });


    </script>



{% endblock %}
